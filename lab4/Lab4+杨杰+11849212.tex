
                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University Assignment Title Page
% LaTeX Template
% Version 1.0 (27/12/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% WikiBooks (http://en.wikibooks.org/wiki/LaTeX/Title_Creation)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Instructions for using this template:
% This title page is capable of being compiled as is. This is not useful for
% including it in another document. To do this, you have two options:
%
% 1) Copy/paste everything between \begin{document} and \end{document}
% starting at \begin{titlepage} and paste this into another LaTeX file where you
% want your title page.
% OR
% 2) Remove everything outside the \begin{titlepage} and \end{titlepage} and
% move this file to the same directory as the LaTeX file you wish to add it to.
% Then add \input{./title_page_1.tex} to your LaTeX file where you want your
% title page.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\title{Title page with logo}
%----------------------------------------------------------------------------------------
%   PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt]{report}
%\documentclass[UTF8]{ctexart}

%_____________________________________________________________________
%my package
\usepackage{float}
\usepackage[margin=2.5cm]{geometry}
 \setlength{\topskip}{1.75cm}
\usepackage{xcolor}
%\usepackage{amssymb}
\usepackage{CJK,CJKnumb,CJKulem}
\usepackage{graphicx,psfrag} % 图形宏包
\usepackage{fancyhdr} %页眉设置
\usepackage[Lenny]{fncychap} %章节样式
%\usepackage{color} % 支持彩色
\usepackage{lastpage}
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
\usepackage{fourier} % Use the Adobe Utopia font for the document - comment this line to return to the LaTeX default
\usepackage[english]{babel} % English language/hyphenation
\usepackage{amsmath,amsfonts,amsthm} % Math packages
\usepackage{paralist}
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{varioref}
\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{\centering \normalfont\scshape} % Make all sections centered, the default font and small caps
\usepackage{float}
\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\headheight 0pt % 页眉高
\addtolength{\headheight}{\baselineskip}

\fancyhead[L]{\usebox{\headpic}}
\fancyhead[c]{\color{gray} Adventurous\\Arduous\\Amiable}
\fancyhead[r]{\usebox{\pp}}
%\fancyhead[r]{\textsc{south university of science and technology of china} \\
	%\textsc{department of biomedical engineering }}

\renewcommand{\headrule}{%
	\hrule width\headwidth height 1.2pt \vspace{1pt}%
	\hrule width\headwidth}
\fancyfoot[c]{\hrule width\headwidth height 1.2pt \thepage / \pageref{LastPage} }

%调用页眉：rhead是logo图标放在右上角，左上角为lhead，中间位chead
%\setlength{\headheight}{0.136pt} % Customize the height of the header


\newsavebox{\headpic}
\sbox{\headpic}{\includegraphics[height=2cm]{school.png}} %校徽
\newsavebox{\pp}
\sbox{\pp}{\includegraphics[height=1.35cm,,width=5.5cm]{department.png}} %系徽

%	TITLE SECTION


%____________________________________________________________________________________________
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
%\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{epstopdf}


\usepackage{pifont}
\usepackage[colorlinks,linkcolor=black]{hyperref}


%---------------------------------------------------------------------------------------------------------------------

\renewcommand\appendix{\setcounter{secnumdepth}{-1}}
\usepackage{titlesec}
%\titleformat{\section}%{\bfseries}
\usepackage{mdframed}


\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
\usepackage{subfigure}
%---------------代码插入-------------------------

\usepackage{listings}
\lstset{language=C++}
\lstset{breaklines}%这条命令可以让LaTeX自动将长的代码行换行排版
\lstset{extendedchars=false}%这一条命令可以解决代码跨页时，章节标题，页眉等汉字不显示的问题
%\usepackage[usenames,dvipsnames]{xcolor}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\lstset{
 backgroundcolor=\color{lightgray},
 basicstyle = \footnotesize,
 breakatwhitespace = false,
 breaklines = true,
 captionpos = b,
 commentstyle = \color{mygreen}\bfseries,
 extendedchars = false,
 frame =shadowbox,
 framerule=0.5pt,
 keepspaces=true,
 keywordstyle=\color{blue}\bfseries, % keyword style
 language = C++,                     % the language of code
 otherkeywords={string,Mat},
 numbers=left,
 numbersep=5pt,
 numberstyle=\tiny\color{mygray},
 rulecolor=\color{black},
 showspaces=false,
 showstringspaces=false,
 showtabs=false,
 stepnumber=1,
 stringstyle=\color{mymauve},        % string literal style
 tabsize=2,
 title=\lstname
}

\makeatletter %使\section中的内容左对齐
\renewcommand{\section}{\@startsection{section}{0}{0mm}
  {-\baselineskip}{0\baselineskip}{\LARGE \bf\leftline}}
\makeatother
\makeatletter %使\section中的内容左对齐
\renewcommand{\subsection}{\@startsection{subsection}{0}{4mm}
  {-\baselineskip}{1\baselineskip}{\Large\bf\leftline}}
\makeatother
\makeatletter %使\section中的内容左对齐
\renewcommand{\subsubsection}{\@startsection{subsubsection}{0}{8mm}
  {-\baselineskip}{1\baselineskip}{\large\bf\leftline}}
\makeatother

\newcommand{\fref}[1]{\textbf{Fig.\ref{#1}}}
\newcommand{\ffref}[2]{\textbf{Fig.\ref{#1}-#2}}
\newcommand{\eref}[1]{\textbf{Eq.\ref{#1}}}
\begin{document}
\begin{CJK*}{GBK}{song}

\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

\center % Center everything on the page

%----------------------------------------------------------------------------------------
%   HEADING SECTIONS
%----------------------------------------------------------------------------------------

\textsc{\LARGE South University of Science and Technology of China}\\[1.5cm] % Name of your university/college
\textsc{\Large Image and Video Processing }\\[0.5cm] % Major heading such as course name
\textsc{\large class project 3}\\[0.5cm] % Minor heading such as course title

%----------------------------------------------------------------------------------------
%   TITLE SECTION
%----------------------------------------------------------------------------------------

\HRule \\[0.4cm]
{ \huge \bfseries Fourier Transform}\\[0.4cm] % Title of your document
\HRule \\[1.5cm]

%----------------------------------------------------------------------------------------
%   AUTHOR SECTION
%----------------------------------------------------------------------------------------

\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\emph{Author:}\\
Jie \textsc{Yang} % Your name
\end{flushleft}
\end{minipage}
~
\begin{minipage}{0.4\textwidth}
\begin{flushright} \large
\emph{Supervisor:} \\
 \textsc{Jianhong Shi} % Supervisor's Name
\end{flushright}
\end{minipage}\\[2cm]

% If you don't want a supervisor, uncomment the two lines below and remove the section above
%\Large \emph{Author:}\\
%John \textsc{Smith}\\[3cm] % Your name

%----------------------------------------------------------------------------------------
%   DATE SECTION
%----------------------------------------------------------------------------------------

{\large \today}\\[2cm] % Date, change the \today to a set date if you want to be precise

%----------------------------------------------------------------------------------------
%   LOGO SECTION
%----------------------------------------------------------------------------------------

\includegraphics[height=5cm]{logo.png}\\%[1cm] % Include a department/university logo - this will require the graphicx package

%----------------------------------------------------------------------------------------

\vfill % Fill the rest of the page with whitespace

\end{titlepage}

\thispagestyle{empty}




\tableofcontents
\newpage


\pagestyle{fancyplain}









%--------------------------------------------------------------------------------
%article start
%----------------------------------------------------------------

%\begin{abstract}
%Your abstract.
%\end{abstract}

\centerline{\textbf{\huge Fourier Transform}}

\setcounter{page}{1}
\appendix
%\subsection{\textbf{objective}}
%\begin{enumerate}
%  \item Know the principle of spectrophotometer.
%  \item Understand the principle of the law of Lambert-Beer.
%  \item Master how to calculate absorbance and extinction coefficient base on the law of Lambert-Beer.
%\end{enumerate}
\section{\textbf{Introduction}}\ \ \ \ \ \ \

In most common conditions, the talk about the image in space domain, which indicate the intensity distribution of a image. However, an image can be transformed to frequency domain by Fourier transform. Because image is discrete matrix, it is discrete Fourier transform (DFT).

In space domain, the matrix indicate power distribution in each frequency component. So that we can process image in frequency domain which can be very easy to do filtering. This powerful method nowadays applied broadly in lots of fields.

In this experiment, we will write DFT function to implement 2D DFT for all provided images and analyze their
transformed images in frequency domain. We will also reconstruct lena.pgm using the magnitude and phase images in frequency domain respectively and analyze the results.





\section{\textbf{Method}}\ \ \ \ \ \ \

For each image, we can calculate its frequency component by \eref{eq:DFT}, $M,N$ is the length and width as image, respectively. This progress is DFT. After that, we can do reverse transform to reconstruct image,\eref{eq:DFT} which transform image from frequency domain to spatial domain.
\begin{equation}\label{eq:DFT}
F(u,v)=\sum ^{M-1}_{x=0}\sum ^{N-1}_{y=0}f(x,y)e^{-j2\pi(ux/M+vy/N)}
\end{equation}

\begin{equation}\label{eq:IDFT}
f(x,y)= \frac{1}{MN}\sum ^{M-1}_{u=0}\sum ^{N-1}_{v=0}F(u,v)e^{j2\pi(ux/M+vy/N)}
\end{equation}
In frequency domain, the low frequency component at the corner while high frequency at the center. To make it clear, we can shift original point to the image center, so that from center to edge, the frequency gradually decrease. This shift step can be done base on \eref{eq:shift}. by multiply $(-1)^{(x+y)}$ in frequency domain or spatial domain before DFT.

\begin{equation}\label{eq:shift}
\begin{array}{ccc}
f(x,y)(-1)^{x+y} &\Leftrightarrow &F(u-M/2,v-N/2)\\
f(x-M/2,y-N/2)&\Leftrightarrow  &F(u,v)(-1)^{u+v}
\end{array}
\end{equation}

The full steps in this lab is indicated in \eref{eq:IDFT}. First, we multiply image with $(-1)^{(x+y)}$ , then do DFT to transform image to frequency domain.
For reverse DFT (IDFT), we can do DFT to frequency image then get its real part, finally multiply it with $(-1)^{(x+y)}$ to reconstruct image.

\begin{equation}\label{eq:IDFT}
f(x,y) \xrightarrow{*(-1)^{x+y}}g(x,y)  \xrightarrow{\mathfrak{F}} F(u,v) \xrightarrow{\mathfrak{F}} f(u,v)\xrightarrow{\mathfrak{Re}} \mathfrak{Re}(f(u,v))\xrightarrow{*(-1)^{x+y}} f(x,y)
\end{equation}










\section{\textbf{Results}}\ \ \ \ \ \ \


\subsection{\textbf{DFT}}\ \ \ \ \ \ \
We find that after DFT, the magnitude is two weak to see, so I choose to plot the log form of magnitude.

From bridge image, the main is at low frequency part, it has bright line on vertical and horizontal axis. The vertical one is brighter that horizontal one. Because the brighter part in image is the bridge while it is on horizontal axis.\fref{fig:bridge}. The phase image seems to be no order.
%\vspace{-0.2cm}

\setlength{\intextsep}{0.1cm}
\setlength{\abovecaptionskip}{0.05cm}
\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/bridge_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/bridge_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/bridge_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/bridge_DFT_phase.jpg}}
\caption{Fourier transform of bridge image}
\label{fig:bridge}
\end{figure}
For circles image,\fref{fig:circles} there are several circle line around center and phase image also be symmetrical
\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/circles_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/circles_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/circles_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/circles_DFT_phase.jpg}}
\caption{Fourier transform of circles image}
\label{fig:circles}
\end{figure}



\begin{figure}[H]
\setlength{\abovedisplayskip}{-5pt}
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/crosses_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/crosses_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/crosses_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/crosses_DFT_phase.jpg}}
\caption{Fourier transform of crosses image}
\label{fig:crosses}
\end{figure}
For crosses image,\fref{fig:crosses} there are several diagonal vertical and horizontal lines, so that we can see for lines in magnitude image, the phase image also be ordered.




\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/goldhill_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/goldhill_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/goldhill_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/goldhill_DFT_phase.jpg}}
\caption{Fourier transform of goldhill image}
\label{fig:goldhill}
\end{figure}
For goldhill image,\fref{fig:goldhill}, it has house with white walls, which induce bright vertical line and closer horizontal areal in magnitude image, in phase image, we can see vertical line.

\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/horiz_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/horiz_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/horiz_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/horiz_DFT_phase.jpg}}
\caption{Fourier transform of horiz image}
\label{fig:horiz}
\end{figure}


For horiz image,\fref{fig:horiz}, it has several vertical lines in image, so that we can see a bright vertical line in magnitude image and the phase image be very ordered.





\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/montage_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/montage_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/montage_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/montage_DFT_phase.jpg}}
\caption{Fourier transform of montage image}
\label{fig:montage}
\end{figure}







For montage image \fref{fig:montage}, it be divided into four parts, however, the magnitude image is not the combine of part parts individually, each part has similar magnitude image. The phase image also be divided into four parts.
\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/noise_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/noise_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/noise_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/noise_DFT_phase.jpg}}
\caption{Fourier transform of noise image}
\label{fig:noise}
\end{figure}


For noise image \fref{fig:noise}, the magnitude image is smoother than original image while most power concentrate in low frequency part. Its phase image is orderless like original image.
\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/rampe128_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/rampe128_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/rampe128_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/rampe128_DFT_phase.jpg}}
\caption{Fourier transform of rampe128 image}
\label{fig:rampe128}
\end{figure}




For rampe128 \fref{fig:rampe128}, the main bright part is vertical or horizontal, so that there are two lines in magnitude image. For phase image, the high angle concentrate in horizontal axis.


\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/rampr128_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/rampr128_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/rampr128_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/rampr128_DFT_phase.jpg}}
\caption{Fourier transform of rampr128 image}
\label{fig:rampr128}
\end{figure}






\subsection{\textbf{Image reconstruction}}\ \ \ \ \ \ \
\vspace{-0.8cm}

We choose lena image to do reconstruction in this experiment. From magnitude image, main power are in low frequency and two axis in magnitude and phase image.\fref{fig:lena}.

\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/lena_original.jpg}}
\subfigure[magnitude ]{
\includegraphics[width=4 cm]{matlab1/lena_DFT_mag.jpg}}
\subfigure[log magnitude]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/lena_DFT_mag_log.jpg}}
\subfigure[phase]{
\includegraphics[width=4 cm]{matlab1/lena_DFT_phase.jpg}}
\caption{Fourier transform of lena image}
\label{fig:lena}
\end{figure}

\vspace{-0.8cm}
\begin{figure}[H]
\centering
\subfigure[original]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4 cm]{matlab1/lena_original.jpg}}
\subfigure[magnitude]{
\includegraphics[width=4 cm]{matlab1/lena_IDFT_mag_log.jpg}}
\subfigure[log phase]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4 cm]{matlab1/lena_IDFT_phase_log.jpg}}
\subfigure[magnitude $\&$ phase]{
\includegraphics[width=4 cm]{matlab1/lena_IDFT.jpg}}
\caption{Reconstructed lena image}
\label{fig:lena}
\end{figure}


When only use magnitude image to do reconstruction, we can not see the lena in reconstructed image. However, when only use phase to reconstruct, after log enhancement and hist equalization, we can see the outline of lena. When we use magnitude and phase information together to do reconstruction, we can reconstruct image perfectly.\fref{fig:lena}


\section{\textbf{Discussion}}\ \ \ \ \ \

In this experiment, we can find that when the magnitude image contain the intensity information of the image, when we rotate image, its magnitude image will also rote but the phase dose not. The phase image contain the phase information of each frequency component. 

During reconstruction step, we find that, phase image has for information that magnitude image, because we can see outline of image through phase image that just use magnitude image. The reason is that, if we use phase image only, we suppose that all intensity of each frequency component to be same, that likely to weight each component at each pixel, however, low frequency has higher amplitude while high frequency has low amplitude. This weight will increase high frequency component, for edge pixel, it most composed of high frequency, so we can see the outline of image in reconstruct image only with phase.

When we only use magnitude image to reconstruct image, it is same to shift all phase to zero for each pixel, because the phase of lena image of each pixel is not same, this shift let pixel value to be random, so we can not see image in reconstruct image.

The reconstruct step indicate that phase image contains more information than magnitude image.



\section{\textbf{Supplementary}}\ \ \ \ \ \

This is the code used in this project.
\begin{lstlisting}[title=C++ code for image processing]
#include <opencv2/opencv.hpp>
#include <iostream>
#include <string>
#define _USE_MATH_DEFINES
#include <complex.h>
#include<math.h>
#include "PUABLIC.h"


using namespace cv;
using namespace std;


Mat Hiseq(Mat ima){
	Mat img = Mat::zeros(ima.rows, ima.cols, CV_8UC1);
	ima.convertTo(img, CV_8UC1, 1, 0);
	//cout <<'\n'<< img << endl;

	Mat IM = Mat::zeros(img.rows, img.cols, CV_8UC1);

	double minv = 0.0, maxv = 0.0;
	double* minp = &minv;
	double* maxp = &maxv;
	minMaxIdx(img, minp, maxp);
	//cout << *minp << endl;
	//cout << *maxp << endl;
	int L = *maxp - *minp + 1;
	IM = (img - *minp)*255/L;

	
	
	
	return IM;
	

}

Mat getlayer(Mat src, int k){
	double M = src.rows;
	double N = src.cols;
	Mat layer (M, N, CV_64FC1);
	for (int x = 0; x < src.rows; ++x){
		for (int y = 0; y < src.cols; ++y){
			layer.at<double>(x, y) = src.at<Vec4d>(x, y)[k];


		}
	}
	return layer;

}


Mat mydft2(Mat src){
	
	double M = src.rows;
	double N = src.cols;
	Mat DFTI(M, N, CV_64FC4);
	//Mat DFTI(M, N, CV_64FC2, Scalar_<double>(0.0, 0.0));
	//Mat img(3, 4, CV_64FC2, Scalar_<double>(12.625, 3.141592653));
	

	for (int x = 0; x < src.rows; ++x){
		for (int y = 0; y < src.cols; ++y){
			complex<double> temp = 0;
			for (int u = 0; u < src.rows; ++u){
				for (int v = 0; v < src.cols; ++v){
					//Complex a = Complex< float>::Complex(0, 2 * M_PI*(u*x / M + v*y / N));
					double aa = v*y/N;
					//cout << v << "  v\t" << y << "  y \t"<< aa << "  aa\t"<< endl;

					complex<double> a(0, -1*2 * M_PI*(u*x / M + v*y / N));
					//cout << "+++" << x << '\t' << u << '\t' << y<< '\t'<<v<<endl;
					//cout << "++++++++++" << 'u*x ' << u*x << 'v*y/N' << v*y / N<<(u*x / M + v*y / N) << '\t' << 2 * M_PI*(u*x / M + v*y / N) << '\t' << a << endl;
					
					double val= src.at<double>(u, v);
					
					temp = temp + val*pow((-1) ,(u+v))*exp(a);
				}
			}
			//cout << x << "\t" << y << "val\t" << temp << endl;
			
			//DFTI.at<std::complex<double> >(x, y) = temp;

			DFTI.at<Vec4d>(x, y)[0] = temp.real();
			DFTI.at<Vec4d>(x, y)[1] = temp.imag();
			DFTI.at<Vec4d>(x, y)[2] = abs(temp);
			DFTI.at<Vec4d>(x, y)[3] = arg(temp);
			//cout << DFTI << endl;


		}
	}




	return DFTI;
	
	

}



Mat myidft2(Mat reval, Mat imval){
	

	double M = reval.rows;
	double N = reval.cols;
	Mat IDFTI(M, N, CV_64FC4);

	for (int x = 0; x < reval.rows; ++x){
		for (int y = 0; y < reval.cols; ++y){
			complex<double> temp = 0;
			for (int u = 0; u < reval.rows; ++u){
				for (int v = 0; v < reval.cols; ++v){
					
				
					

					complex<double> a(0, 1 * 2 * M_PI*(u*x / M + v*y / N));
					//double reval = src.at<Vec4d>(x, y)[0];
					//double imval = src.at<Vec4d>(x, y)[1];
					double Re = reval.at<double>(u, v);
					double Im = imval.at<double>(u, v);

	
					complex<double> val(Re,Im);
					temp = temp + val*exp(a);
				}
			}
			
			temp = temp / (M*N)*pow(-1, (x + y));
			IDFTI.at<Vec4d>(x, y)[0] = temp.real();
			IDFTI.at<Vec4d>(x, y)[1] = temp.imag();
			IDFTI.at<Vec4d>(x, y)[2] = abs(temp);
			IDFTI.at<Vec4d>(x, y)[3] = arg(temp);
			


		}
	}




	return IDFTI;



}




string ImageNameList[] = { "bridge", "circles" ,"crosses","goldhill","horiz","lena","montage","noise","rampe128","rampr128"};
//string ImageNameList[] = { "test"};
ImgProp imgprop = {
	"D://graduated//Image_process//lab//PGM_images//",
	".pgm" };
ImgProp imgsave = { "D://graduated//Image_process//lab//lab_report//lab4//imagesave//",
".jpg" };

int len = sizeof(ImageNameList) / sizeof(ImageNameList[0]);// namelist length


void lab3_main()
{
	
	for (int i = 0; i < len;i++){
		imgprop.img_name = ImageNameList[i];
		imgsave.img_name = imgprop.img_name;
		string img_path = imgprop.img_fold + imgprop.img_name + imgprop.type;
		Mat ima = imread(img_path, 0); //read gray image
		imshow("original    " + imgprop.img_name, ima);

		imgsave.img = ima;
		
		imgsave.mark = "original";
		img_save(imgsave);

		Mat fimg;
		ima.convertTo(fimg, CV_64FC1, 1, 0);// no shift and scale
		Mat zoro = Mat::zeros(fimg.rows, fimg.cols, CV_64FC1);
		//*************   dft**************

		Mat DFT_img;
		
		//cout << fimg << endl;
		DFT_img=mydft2(fimg);

		Mat magDFT_img = getlayer(DFT_img,2);
		Mat phaseDFT_img = getlayer(DFT_img,3);
		
		
		imgsave.img = Hiseq(magDFT_img);
		imgsave.mark = "DFT_mag";
		img_save(imgsave);

		imgsave.img = Hiseq(phaseDFT_img);
		imgsave.mark = "DFT_phase";
		img_save(imgsave);
		//*************   dft**************


		//*************   idft**************
		
		Mat IDFT_img_full = myidft2(getlayer(DFT_img, 0), getlayer(DFT_img, 1));
		Mat IDFT_img = getlayer(IDFT_img_full, 0);

		Mat magIDFT_img_full = myidft2(magDFT_img, zoro);
		Mat magIDFT_img = getlayer(magIDFT_img_full, 0);

		Mat phaseIDFT_img_full = myidft2(phaseDFT_img, zoro);
		Mat phaseIDFT_img = getlayer(phaseIDFT_img_full, 0);
		cout << IDFT_img << endl;
		imgsave.img = Hiseq(IDFT_img);
		cout << imgsave.img << endl;
		imgsave.mark = "IDFT_mag";

		imgsave.img = Hiseq(magIDFT_img);
		imgsave.mark = "IDFT_mag";
		img_save(imgsave);

		imgsave.img = Hiseq(phaseIDFT_img);
		imgsave.mark = "IDFT_phase";
		img_save(imgsave);
		


		//*************   idft**************

			
	}
}
 
}




\end{lstlisting}

\end{CJK*}
\end{document}
