
                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University Assignment Title Page
% LaTeX Template
% Version 1.0 (27/12/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% WikiBooks (http://en.wikibooks.org/wiki/LaTeX/Title_Creation)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Instructions for using this template:
% This title page is capable of being compiled as is. This is not useful for
% including it in another document. To do this, you have two options:
%
% 1) Copy/paste everything between \begin{document} and \end{document}
% starting at \begin{titlepage} and paste this into another LaTeX file where you
% want your title page.
% OR
% 2) Remove everything outside the \begin{titlepage} and \end{titlepage} and
% move this file to the same directory as the LaTeX file you wish to add it to.
% Then add \input{./title_page_1.tex} to your LaTeX file where you want your
% title page.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\title{Title page with logo}
%----------------------------------------------------------------------------------------
%   PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt]{report}
%\documentclass[UTF8]{ctexart}

%_____________________________________________________________________
%my package
\usepackage{float}
\usepackage[margin=2.5cm]{geometry}
 \setlength{\topskip}{1.75cm}
\usepackage{xcolor}
%\usepackage{amssymb}
\usepackage{CJK,CJKnumb,CJKulem}
\usepackage{graphicx,psfrag} % 图形宏包
\usepackage{fancyhdr} %页眉设置
\usepackage[Lenny]{fncychap} %章节样式
%\usepackage{color} % 支持彩色
\usepackage{lastpage}
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
\usepackage{fourier} % Use the Adobe Utopia font for the document - comment this line to return to the LaTeX default
\usepackage[english]{babel} % English language/hyphenation
\usepackage{amsmath,amsfonts,amsthm} % Math packages
\usepackage{paralist}
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{varioref}
\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{\centering \normalfont\scshape} % Make all sections centered, the default font and small caps
\usepackage{float}
\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\headheight 0pt % 页眉高
\addtolength{\headheight}{\baselineskip}

\fancyhead[L]{\usebox{\headpic}}
\fancyhead[c]{\color{gray} Adventurous\\Arduous\\Amiable}
\fancyhead[r]{\usebox{\pp}}
%\fancyhead[r]{\textsc{south university of science and technology of china} \\
	%\textsc{department of biomedical engineering }}

\renewcommand{\headrule}{%
	\hrule width\headwidth height 1.2pt \vspace{1pt}%
	\hrule width\headwidth}
\fancyfoot[c]{\hrule width\headwidth height 1.2pt \thepage / \pageref{LastPage} }

%调用页眉：rhead是logo图标放在右上角，左上角为lhead，中间位chead
%\setlength{\headheight}{0.136pt} % Customize the height of the header


\newsavebox{\headpic}
\sbox{\headpic}{\includegraphics[height=2cm]{school.png}} %校徽
\newsavebox{\pp}
\sbox{\pp}{\includegraphics[height=1.35cm,,width=5.5cm]{department.png}} %系徽

%	TITLE SECTION


%____________________________________________________________________________________________
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
%\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{epstopdf}


\usepackage{pifont}
\usepackage[colorlinks,linkcolor=black]{hyperref}


%---------------------------------------------------------------------------------------------------------------------

\renewcommand\appendix{\setcounter{secnumdepth}{-1}}
\usepackage{titlesec}
%\titleformat{\section}%{\bfseries}
\usepackage{mdframed}


\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
\usepackage{subfigure}
%---------------代码插入-------------------------

\usepackage{listings}
\lstset{language=C++}
\lstset{breaklines}%这条命令可以让LaTeX自动将长的代码行换行排版
\lstset{extendedchars=false}%这一条命令可以解决代码跨页时，章节标题，页眉等汉字不显示的问题
%\usepackage[usenames,dvipsnames]{xcolor}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\lstset{
 backgroundcolor=\color{lightgray},
 basicstyle = \footnotesize,
 breakatwhitespace = false,
 breaklines = true,
 captionpos = b,
 commentstyle = \color{mygreen}\bfseries,
 extendedchars = false,
 frame =shadowbox,
 framerule=0.5pt,
 keepspaces=true,
 keywordstyle=\color{blue}\bfseries, % keyword style
 language = C++,                     % the language of code
 otherkeywords={string,Mat},
 numbers=left,
 numbersep=5pt,
 numberstyle=\tiny\color{mygray},
 rulecolor=\color{black},
 showspaces=false,
 showstringspaces=false,
 showtabs=false,
 stepnumber=1,
 stringstyle=\color{mymauve},        % string literal style
 tabsize=2,
 title=\lstname
}

\makeatletter %使\section中的内容左对齐
\renewcommand{\section}{\@startsection{section}{0}{0mm}
  {-\baselineskip}{0\baselineskip}{\LARGE \bf\leftline}}
\makeatother
\makeatletter %使\section中的内容左对齐
\renewcommand{\subsection}{\@startsection{subsection}{0}{4mm}
  {-\baselineskip}{1\baselineskip}{\Large\bf\leftline}}
\makeatother
\makeatletter %使\section中的内容左对齐
\renewcommand{\subsubsection}{\@startsection{subsubsection}{0}{8mm}
  {-\baselineskip}{1\baselineskip}{\large\bf\leftline}}
\makeatother

\newcommand{\fref}[1]{\textbf{Fig.\ref{#1}}}
\newcommand{\ffref}[2]{\textbf{Fig.\ref{#1}-#2}}
\newcommand{\eref}[1]{\textbf{Eq.\ref{#1}}}
\begin{document}
\begin{CJK*}{GBK}{song}

\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

\center % Center everything on the page

%----------------------------------------------------------------------------------------
%   HEADING SECTIONS
%----------------------------------------------------------------------------------------

\textsc{\LARGE South University of Science and Technology of China}\\[1.5cm] % Name of your university/college
\textsc{\Large Image and Video Processing }\\[0.5cm] % Major heading such as course name
\textsc{\large class project 1}\\[0.5cm] % Minor heading such as course title

%----------------------------------------------------------------------------------------
%   TITLE SECTION
%----------------------------------------------------------------------------------------

\HRule \\[0.4cm]
{ \huge \bfseries Image Resizing}\\[0.4cm] % Title of your document
\HRule \\[1.5cm]

%----------------------------------------------------------------------------------------
%   AUTHOR SECTION
%----------------------------------------------------------------------------------------

\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\emph{Author:}\\
Jie \textsc{Yang} % Your name
\end{flushleft}
\end{minipage}
~
\begin{minipage}{0.4\textwidth}
\begin{flushright} \large
\emph{Supervisor:} \\
 \textsc{Jianhong Shi} % Supervisor's Name
\end{flushright}
\end{minipage}\\[2cm]

% If you don't want a supervisor, uncomment the two lines below and remove the section above
%\Large \emph{Author:}\\
%John \textsc{Smith}\\[3cm] % Your name

%----------------------------------------------------------------------------------------
%   DATE SECTION
%----------------------------------------------------------------------------------------

{\large \today}\\[2cm] % Date, change the \today to a set date if you want to be precise

%----------------------------------------------------------------------------------------
%   LOGO SECTION
%----------------------------------------------------------------------------------------

\includegraphics[height=5cm]{logo.png}\\%[1cm] % Include a department/university logo - this will require the graphicx package

%----------------------------------------------------------------------------------------

\vfill % Fill the rest of the page with whitespace

\end{titlepage}

\thispagestyle{empty}




\tableofcontents
\newpage


\pagestyle{fancyplain}









%--------------------------------------------------------------------------------
%article start
%----------------------------------------------------------------

%\begin{abstract}
%Your abstract.
%\end{abstract}

\centerline{\textbf{\huge Image resizing}}

\setcounter{page}{1}
\appendix
%\subsection{\textbf{objective}}
%\begin{enumerate}
%  \item Know the principle of spectrophotometer.
%  \item Understand the principle of the law of Lambert-Beer.
%  \item Master how to calculate absorbance and extinction coefficient base on the law of Lambert-Beer.
%\end{enumerate}
\section{\textbf{Introduction}}\ \ \ \ \ \ \

Image resizing is a kind of method to change image size, which can be divided into reduce image size and enlarge image size. It is very useful in image processing. Image reduce usually remove several lines in original image to decrease image size. While image enlargement require to generate new lines, which cause interpolation. Interpolation is a kind method which can generate new pixels base on neighborhood pixels. In this project, bilinear and bicubic interpolation will be discussed.


\section{\textbf{Method}}\ \ \ \ \ \ \

For each pixel in resized image $f(x,y)$, we can map it to original image by \eref{eq:proj}. Then we can use different interpolation method to determine its value.

\begin{equation}\label{eq:ALR}
\left\{
\begin{array}{lr}
\hat{x}= & x/scale \\
\hat{y}=& y/scale
\end{array}
\right.
\end{equation}


  \subsection{Alternative line reduction \& pixel replication}\ \ \ \ \ \ \
  For alternative line reduction and pixel replication, they has same calculation process. The difference is that former used to reduce image size while later used to enlarge image size.
 \begin{equation}\label{eq:proj}
\left\{
\begin{array}{lr}
\tilde{x}= & ceil(\hat{x}) \\
\tilde{y}=& ceil(\hat{x})
\end{array}
\right.
\end{equation}

  For each $\hat{x}$, we choose the nearest integer as the mapped coordinates by \eref{eq:ALR}. Then transfer this pixel intensity to the resized image pixel.\eref{eq:PRX}
  \begin{equation}\label{eq:PRX}
    f(x,y)=F(\tilde{x},\tilde{y})
  \end{equation}


\subsection{Nearest enlargement}\ \ \ \ \ \ \
For each $\hat{x}$, we choose the nearest integer as the mapped coordinates by \eref{eq:NEE}. Then transfer this pixel intensity to the resized image pixel.\eref{eq:PRX}
\begin{equation}\label{eq:NEE}
\tilde{x}=
\left\{
\begin{array}{lr}
ceil(\hat{x}),\ \ ceil(\hat{x})-\hat{x} < 0.5 \\
floor(\hat{x}),\ \ ceil(\hat{x})-\hat{x} \geq 0.5
\end{array}
\right.
\tilde{y}=
\left\{
\begin{array}{lr}
ceil(\hat{y}),\ \ ceil(\hat{y})-\hat{y} < 0.5 \\
floor(\hat{y}),\ \ ceil(\hat{y})-\hat{y} \geq 0.5
\end{array}
\right.
\end{equation}

\subsection{Bilinear interpolation}\ \ \ \ \ \ \
Bilinear interpolation dose not just map one pixel to new image, but find two near pixels in original image \eref{eq:Bil} then give weight to each pixel and calculate their weighted sum as the intensity of new pixel.\eref{eq:Bilinear}

\begin{equation}\label{eq:Bil}
\left\{
\begin{array}{lllrr}
\hat{x_l}=& floor(\hat{x})&\ &\hat{y_l}=& ceil(\hat{y}) \\
\hat{x_r}=& floor(\hat{x})&\ &\hat{y_r}=& ceil(\hat{x})\\
p =& \hat{x}-\hat{x_l}&\ &q =& \hat{y}-\hat{y_l}
\end{array}
\right.
\end{equation}






\begin{equation}\label{eq:Bilinear}
\begin{array}{lllrr}
f(x,y)=&(1-q)*(p*F(\tilde{x_r},\tilde{y_l})+(1-p)*F(\tilde{x_l},\tilde{y_l}))+\\
& q*(p*F(\tilde{x_l},\tilde{y_r})+(1-p)*F(\tilde{x_r},\tilde{y_r}))
\end{array}
\end{equation}



\subsection{Bicubic interpolation}\ \ \ \ \ \ \
This method use cubic polynomial $w(x)$ to approach optimal interpolation function $sin(x)/x$ \eref{eq:wx}.
\begin{figure}[H]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=10cm]{bicubic.png}\\
  \caption{Diagram of bicubic interpolation }\label{fig:bicubic}
\end{figure}

\begin{equation}\label{eq:wx}
w(x)=
\left\{
\begin{array}{lll}
1-2|x|^2+|x|^3 & 0\leq &|x|<1 \\
4-8|x|+5|x|^2-|x|^3 & 1\leq &|x|<2 \\
0 & 2\leq &|x|
\end{array}
\right.
\end{equation}
First step is map $f(x,y)$ to $F(x,y)$.\eref{eq:xhatt}. Then calculate map distance for next step.\eref{eq:ab}.

 \begin{equation}\label{eq:xhatt}
\left\{
\begin{array}{lr}
\tilde{x}= & floor(\hat{x}) \\
\tilde{y}=& floor(\hat{x})
\end{array}
\right.
\end{equation}

 \begin{equation}\label{eq:ab}
\left\{
\begin{array}{lr}
\alpha= & \hat{x}-\tilde{x} \\
\beta=& \hat{y}-\tilde{y}
\end{array}
\right.
\end{equation}

Bicubic interpolation do polynomial in $4 x 4$ neighbourhood.\fref{fig:bicubic}. It first do cubic interpolation at four horizontal lines to get $g(a),g(b),g(c),g(d)$.\eref{eq:hine} Then do vertical cubic interpolation between $g(a),g(b),g(c),g(d).$\eref{eq:vine}
\begin{equation}\label{eq:hine}
\begin{array}{lll}
g(u,v)&=&w(1+\alpha)F(u-1,v)+w(\alpha)F(u,v)\\
&+& w(1-\alpha)F(u+1,v)+w(2-\alpha)F(u+2,v)\\
\end{array}
\end{equation}
\begin{equation}\label{eq:vine}
\begin{array}{lll}
f(x,y)&=&w(1+\beta)g(u,v-1)+w(\beta)g(u,v)\\
&+& w(1-\beta)g(u,v+1)+w(2-\beta)g(u,v+2)\\
\end{array}
\end{equation}

The whole process can be write in matrix form.\eref{eq:bicubic}





\begin{equation}\label{eq:A}
  A=\left[\begin{matrix}w(1+\alpha)&w(\alpha)&w(\alpha)&w(2-\alpha)\end{matrix}\right]
\end{equation}

\begin{equation}\label{eq:B}
B=
  \left[
 \begin{matrix}
   F(u-1,v-1) &F(u-1,v) & F(u-1,v+1)&F(u-1,v+2) \\
   F(u,v-1) &F(u,v) & F(u,v+1)&F(u,v+2) \\
   F(u+1,v-1) &F(u+1,v) & F(u+1,v+1)&F(u+1,v+2) \\
   F(u+2,v-1) &F(u+2,v) & F(u+2,v+1)&F(u+2,v+2)
  \end{matrix}
  \right]
\end{equation}

\begin{equation}\label{eq:C}
  C=\left[\begin{matrix}w(1+\beta)&w(\beta)&w(\beta)&w(2-\beta)\end{matrix}\right]^{T}
\end{equation}

\begin{equation}\label{eq:bicubic}
  f(x,y)=A\times B \times C
\end{equation}






\section{\textbf{Results}}\ \ \ \ \ \ \

These are the original images.\fref{fig:original}
\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=2.7 cm]{imagesave/crosses_original.jpg}}
\hspace{5 cm}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=2.7 cm]{imagesave/circles_original.jpg}}
\caption{Original images}
\label{fig:original}
\end{figure}

\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=1.35 cm]{imagesave/crosses_NEE_0_5x0_5.jpg}}
\hspace{7 cm}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=1.35 cm]{imagesave/circles_NEE_0_5x0_5.jpg}}
\caption{Reduce to half size by alternative line reduction}
\label{fig:NEE_reduce}
\end{figure}
\subsection{\textbf{Image reduction}}\ \ \ \ \ \ \
%\begin{itemize}
 \textbf{$\bullet$ Alternative line reduction}

  It is clear to see that the image size reduced to half of original image. \fref{fig:NEE_reduce} However, some horizontal and vertical lines disappeared after reducing. The line which near to diagonal line also disappeared.  \ffref{fig:NEE_reduce}{a}
\\

\textbf{$\bullet$ Fractional linear reduction to reduce images to any smaller size}

It is clear to see that the image size reduced to 0.7 times of original image.\fref{fig:Bilinear_reduce} Although there is no line reduced, the image be blurry. The white line turn to gray.\ffref{fig:Bilinear_reduce}{a} For circles image, the edge becomes indistinct and more artifact appear near edge.\ffref{fig:Bilinear_reduce}{b}

\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=1.89 cm]{imagesave/crosses_Bilinear_0_7x0_7.jpg}}
\hspace{6 cm}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=1.89 cm]{imagesave/circles_Bilinear_0_7x0_7.jpg}}
\caption{Reduce to 0.7$\times$0.7 by bilinear interpolation}
\label{fig:Bilinear_reduce}
\end{figure}

%\end{itemize}


\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=8.1 cm]{imagesave/crosses_PXR_2x3.jpg}}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=8.1 cm]{imagesave/circles_PXR_2x3.jpg}}
\caption{Enlarge to 2$\times$3 by pixel replication}
\label{fig:PXR}
\end{figure}
\subsection{\textbf{Image enlargement}}\ \ \ \ \ \ \
\textbf{$\bullet$ Pixel replication}\ \ \ \ \ \ \

It is clear to see that the width and height enlarged to 3 and 2 times of original image, respectively.\fref{fig:PXR} The image still be clear and no gray pixel generate.\ffref{fig:PXR}{a} For circles image, the edge still be very sharp but can see clear steps near edge.\ffref{fig:PXR}{b}
\\

\textbf{$\bullet$ Nearest enlargement}\ \ \ \ \ \ \

It is clear to see that the width and height enlarged to 3 and 2 times of original image, respectively.\fref{fig:NEE} There is  no gray pixel generate but the line be discontinuous. There are several black line inserted into white vertical lines and the edge of bias also be etched by back line.\ffref{fig:NEE}{a} For circles image, the edge also be etched by near pixels, which induce blurry edge.\ffref{fig:NEE}{b}
\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=8.1 cm]{imagesave/crosses_NEE_2x3.jpg}}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=8.1 cm]{imagesave/circles_NEE_2x3.jpg}}
\caption{Enlarge to 2$\times$3 by nearest enlargement}
\label{fig:NEE}
\end{figure}

\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=8.1 cm]{imagesave/crosses_Bilinear_2x3.jpg}}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=8.1 cm]{imagesave/circles_Bilinear_2x3.jpg}}
\caption{Enlarge to 2$\times$3 by bilinear interpolation}
\label{fig:Bilinear}
\end{figure}
\textbf{$\bullet$ Bilinear interpolation}\ \ \ \ \ \ \

It is clear to see that the width and height enlarged to 3 and 2 times of original image, respectively.\fref{fig:Bilinear} There are gray pixels generated near edge, which induce to smooth edge.\ffref{fig:Bilinear}{a} For circles image, the edge also be smooth.\ffref{fig:Bilinear}{b}
\\

\textbf{$\bullet$ Bicubic interpolation}\ \ \ \ \ \ \

It is clear to see that the width and height enlarged to 3 and 2 times of original image,respectively. \fref{fig:Bicubic} The edge is shaper than bilinear interpolation, but also insert some back pixels near to edge, which let the lines seems like cracked\ffref{fig:Bicubic}{a} For circles image, the edge also be smooth but there are some misplaced pixels near to edge.\ffref{fig:Bicubic}{b}

\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=8.1 cm]{imagesave/crosses_Bicubic_2x3.jpg}}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=8.1 cm]{imagesave/circles_Bicubic_2x3.jpg}}
\caption{Enlarge to 2$\times$3 by Bicubic interpolation}
\label{fig:Bicubic}
\end{figure}

\textbf{$\bullet$ Fractal linear expansion to expand images to any larger size}\ \ \ \ \ \ \

It is clear to see that the size becomes 1.7 times of original image.\fref{fig:fractal} There are gray pixels generated near edge, which induce to smooth edge but also blur the image.\ffref{fig:fractal}{a} For circles image, the edge also be smooth.\ffref{fig:fractal}{b}
\begin{figure}[H]
\centering
\subfigure[Crosses]{
%\label{supsubfig:dye_concentration_SNR_cell}
\includegraphics[width=4.6 cm]{imagesave/crosses_Bilinear_1_7x1_7.jpg}}
\subfigure[Circles]{
%\label{supsubfig:dye_concentration_bias_cell}
\includegraphics[width=4.6 cm]{imagesave/circles_Bilinear_1_7x1_7.jpg}}
\caption{Enlarge to 1.7$\times$1.7 by bilinear interpolation}
\label{fig:fractal}
\end{figure}

\
\section{\textbf{Discussion}}\ \ \ \ \ \

In this experiment, we can find that when use alternative line reduction to reduce image size, it is easy to calculate but it may remove some horizontal or vertical lines, especially when these lines are very narrow. This may cause information drop.

When use pixel replication to enlarge image size, it is also very easy to calculate. But it will cause steps at edge when edge is not horizontal or vertical.

When use nearest enlargement to enlarge image size, it is easy to calculate and will reduce the step, but may cause intensity step, especially when pattern is very narrow.

When use bilinear interpolation to enlarge image size, the edge will be smooth , but it will blur the image, reduce the resolution.

When use bilinear interpolation to enlarge image size, the edge will be shaper than bilinear interpolation, but the calculation is more complex and takes longer times to do interpolation. When there is intensity step at edge, it may induce pixel misplace.
\section{\textbf{Reference}}\ \ \ \ \ \

\url{https://blog.csdn.net/zhangfuliang123/article/details/76659467}

\section{\textbf{Supplementary}}\ \ \ \ \ \

This is the code used in this project.
\begin{lstlisting}[title=C++ code for image processing]
#include <opencv2/opencv.hpp>
#include <iostream>
#include <string>
#include<math.h>
using namespace cv;
using namespace std;


struct ImgProp{
	string img_fold;
	//string save_fold;
	string type;
	string img_name;
	string mark;
	Mat img;
	


};

//enum functype{ ALR, FLR, Pixen, NEE, Bilinear, Bicubic, FLE };
enum interptype{ PXR,NEE, Bilinear, Bicubic };
double PXRenlargement(int x, int y, double Xscale, double Yscale, Mat img){
	//imshow("cedhihfji" ,img);
	//cout << "Nearest enlargement" << endl;
	double val;
	double xhat = x / Xscale;
	double yhat = y / Yscale;

	int xproj = ceil(xhat);
	int yproj = ceil(yhat);
	val = (double)(*(img.data + img.step[0] * xproj + img.step[1] * yproj));
	//cout << x << "," << y << "-->" << xhat << "," << yhat << "\t\t" << val << endl;
	return val;

}
double Nearestenlargement(int x, int y, double Xscale, double Yscale,Mat img){
	//imshow("cedhihfji" ,img);
	//cout << "Nearest enlargement" << endl;
	double val;
	double xhat = x / Xscale;
	double yhat = y / Yscale;
	
	int xproj = (ceil(xhat)-xhat)<0.5 ? floor(xhat) :ceil(xhat);
	int yproj = (ceil(yhat) - yhat)<0.5 ? floor(yhat) : ceil(yhat);
	val = (double)(*(img.data + img.step[0] * xproj + img.step[1] * yproj));
	//cout << x << "," << y << "-->" << xhat << "," << yhat << "\t\t" << val << endl;
	return val;

}
double Bilinearinterpolation(int x, int y, double Xscale, double Yscale, Mat img){
	//cout << "Bilinear interpolation" << endl;
	double val;
	double xhat = x / Xscale;
	double yhat = y / Yscale;
	int x_left = floor(xhat);
	int x_right = ceil(xhat);
	int y_left = floor(yhat);
	int y_right = ceil(yhat);
	double ll = (double)(*(img.data + img.step[0] * x_left + img.step[1] * y_left));
	double lr = (double)(*(img.data + img.step[0] * x_left + img.step[1] * y_right));
	double rl = (double)(*(img.data + img.step[0] * x_right + img.step[1] * y_left));
	double rr = (double)(*(img.data + img.step[0] * x_right + img.step[1] * y_right));
	double p = xhat - x_left;
	double q = yhat - y_left;
	
	val = (1 - q)*(p*rl + (1 - p)*ll) + q*(p*lr + (1 - p)*rr);
	return val;

}


double wcubic(double x,double a){
	double w = 0;
	if (x < 0) x = -x;
	if (x < 1) w = (a + 2)*pow(x, 3) - (a + 3)*pow(x, 2) + 1;
	else if (x<2)  w = a *pow(x, 3) - 5*a*pow(x, 2) + 8*a*x+4;
	return w;
}
Mat get_S_mat(double v){
	double a = -1;
	Mat S(4, 1, CV_64FC1);
	S.at<double>(0, 0) = wcubic(1+v, a);
	S.at<double>(1, 0) = wcubic( v,  a);
	S.at<double>(2, 0) = wcubic(1-v, a);
	S.at<double>(3, 0) = wcubic(2-v, a);
	return S;
}


double Bilcubicinterpolation(int x, int y, double Xscale, double Yscale, Mat img){
	//cout << "Bicubic interpolation" << endl;
	double val;
	
	double xhat = x / Xscale;
	double yhat = y / Yscale;
	int i = floor(xhat);
	int j = floor(yhat);
	double u = xhat - i;
	double v = yhat - j;
	
	Mat B(4, 4, CV_64FC1);
	for (int k = 0; k < 4;++k)
	for (int m = 0; m < 4; ++m)
		B.at<double>(k, m) = (double)(*(img.data + img.step[0] * (i + k - 1) + img.step[1] * (j + m - 1)));
		//cout << k << m << endl;
	
	Mat A = get_S_mat(u);
	Mat C= get_S_mat(v);
	Mat ABC= A.t()*B*C;
	

	val = ABC.at<double>(0, 0);
	
	
	/*
	cout << "test\n" << test<< endl;

	cout << "yiyiyi" << (double)(*(B.data + B.step[0] * 0 + B.step[1] * 0)) << endl;
	cout << "onoeone" << (double)(*(B.data + B.step[1] * 0 + B.step[1] * 1)) << endl;
	cout << "jdfksfjdlk" << (double)(*(B.data + B.step[1] * 2 + B.step[1] * 3)) << endl;
	cout << "A\n" << A << "\nB\n" << B << "\nC\n" << C << "\nABC\n" << ABC << "\nval\t" << val << endl;
	*/
	return val;
}






Mat img_resize(Mat img, double Xscale, double Yscale, interptype intype){
	int xsize = img.rows;
	int ysize = img.cols;
	int xlen = floor(xsize*Xscale);
	int ylen = floor(ysize*Yscale);
	Mat ima(xlen, ylen, CV_8UC1);
	
	for (int x = 0; x <xlen; ++x){
		uchar * p = ima.ptr<uchar>(x);
		for (int y = 0; y <ylen; ++y){

			switch (intype){
			case PXR:p[y] = PXRenlargement(x, y, Xscale, Yscale, img); break;
			case NEE:p[y] = Nearestenlargement(x, y, Xscale, Yscale, img); break;
			case Bilinear:p[y] = Bilinearinterpolation(x, y, Xscale, Yscale, img); break;
			case Bicubic:p[y] = Bilcubicinterpolation(x, y, Xscale, Yscale, img); break;
			default: cout << "Interpoletation type error !" << endl; break;
			}
			
		}
		//cout << x << ":\t" << endl;
	}
	return ima;

}
void img_save(ImgProp imgprop){
	string save_path = imgprop.img_fold + imgprop.img_name + "_" + imgprop.mark + imgprop.type;
	imwrite(save_path, imgprop.img);
	imshow(imgprop.mark + "    " + imgprop.img_name, imgprop.img);
}


int main()
{
	ImgProp imgprop = {
		"D://graduated//Image_process//lab//PGM_images//",
		".pgm" };
	ImgProp imgsave = { "D://graduated//Image_process//lab//lab_report//lab2//imagesave//",
		".jpg" };
	for (int i = 1; i < 3; i++)
	{
		if (i == 1)imgprop.img_name = "crosses";
		else imgprop.img_name = "circles";
		imgsave.img_name = imgprop.img_name;
		string img_path = imgprop.img_fold + imgprop.img_name + imgprop.type;
		Mat img = imread(img_path);
		
		imshow("original    " + imgprop.img_name, img);
		imgsave.img = img;
		imgsave.mark = "original";
		img_save(imgsave);
		
		
		// enlage int times
		imgsave.img = img_resize(img, 2, 3, PXR);
		imgsave.mark = "PXR_2x3";
		img_save(imgsave);
		imgsave.img = img_resize(img, 2, 3, NEE);
		imgsave.mark = "NEE_2x3";
		img_save(imgsave);
		
		imgsave.img = img_resize(img, 2, 3, Bilinear);
		imgsave.mark = "Bilinear_2x3";
		img_save(imgsave);
	
		imgsave.img = img_resize(img,2, 3, Bicubic);
		imgsave.mark = "Bicubic_2x3";
		img_save(imgsave);
		// enlage fravtal  times
		imgsave.img = img_resize(img, 1.7, 1.7, PXR);
		imgsave.mark = "PXR_1_7x1_7";
		img_save(imgsave);
		imgsave.img = img_resize(img, 1.7, 1.7, NEE);
		imgsave.mark = "NEE_1_7x1_7";
		img_save(imgsave);

		imgsave.img = img_resize(img, 1.7, 1.7, Bilinear);
		imgsave.mark = "Bilinear_1_7x1_7";
		img_save(imgsave);

		imgsave.img = img_resize(img, 1.7, 1.7, Bicubic);
		imgsave.mark = "Bicubic_1_7x1_7";
		img_save(imgsave);
		// reduce fractal times
		imgsave.img = img_resize(img, 0.7, 0.7, PXR);
		imgsave.mark = "PXR_0_7x0_7";
		img_save(imgsave);
		imgsave.img = img_resize(img, 0.7, 0.7, NEE);
		imgsave.mark = "NEE_0_7x0_7";
		img_save(imgsave);

		imgsave.img = img_resize(img, 0.7, 0.7, Bilinear);
		imgsave.mark = "Bilinear_0_7x0_7";
		img_save(imgsave);

		imgsave.img = img_resize(img, 0.7, 0.7, Bicubic);
		imgsave.mark = "Bicubic_0_7x0_7";
		img_save(imgsave);
		// reduce int times
		imgsave.img = img_resize(img, 0.5, 0.5, PXR);
		imgsave.mark = "PXR_0_5x0_5";
		img_save(imgsave);
		imgsave.img = img_resize(img, 0.5, 0.5, NEE);
		imgsave.mark = "NEE_0_5x0_5";
		img_save(imgsave);

		imgsave.img = img_resize(img, 0.5, 0.5, Bilinear);
		imgsave.mark = "Bilinear_0_5x0_5";
		img_save(imgsave);

		imgsave.img = img_resize(img, 0.5, 0.5, Bicubic);
		imgsave.mark = "Bicubic_0_5x0_5";
		img_save(imgsave);
		
		

	}


	waitKey(0);
	return 0;
}




\end{lstlisting}

\end{CJK*}
\end{document}
